<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crypto Watcher</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: auto; padding: 2em; }
    input, button { margin: 0.3em 0; padding: 0.5em; width: 100%; }
    .section { border: 1px solid #ccc; padding: 1em; margin-bottom: 2em; border-radius: 8px; }
    h2 { margin-top: 0; }
    pre { background: #f8f8f8; padding: 1em; border-radius: 6px; }
  </style>
</head>
<body>

  <h1>🪙 Crypto Watcher</h1>

  <div class="section">
    <h2>➕ Добавить криптовалюту</h2>
    <input id="coin_add" placeholder="например, bitcoin">
    <button onclick="addCoin()">Добавить</button>
    <div id="add_status"></div>
  </div>

  <div class="section">
    <h2>➖ Удалить криптовалюту</h2>
    <input id="coin_remove" placeholder="например, bitcoin">
    <button onclick="removeCoin()">Удалить</button>
    <div id="remove_status"></div>
  </div>

  <div class="section">
    <h2>📈 Получить цену</h2>
    <input id="coin_price" placeholder="например, bitcoin">
    <input id="timestamp" placeholder="UNIX timestamp (или пусто для текущего)">
    <button onclick="getPrice()">Получить</button>
    <pre id="price_result"></pre>
  </div>

  <script>
    const API = "http://localhost:8080";

    async function addCoin() {
        const coin = document.getElementById("coin_add").value;
        const res = await fetch(API + "/currency/add", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ coin })
        });
        const data = await res.json();
        document.getElementById("add_status").innerText = data.status ? `✅ ${data.status}` : `⚠ Ошибка: ${JSON.stringify(data)}`;
    }

    async function removeCoin() {
        const coin = document.getElementById("coin_remove").value;
        const res = await fetch(API + "/currency/remove", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ coin })
        });
        const data = await res.json();
        document.getElementById("remove_status").innerText = data.status ? `🗑 ${data.status}` : `⚠ Ошибка: ${JSON.stringify(data)}`;
    }

    async function getPrice() {
        const coin = document.getElementById("coin_price").value;
        const ts = document.getElementById("timestamp").value || Math.floor(Date.now() / 1000);
        const res = await fetch(API + "/currency/price", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ coin, timestamp: parseInt(ts) })
        });
        const data = await res.json();
        document.getElementById("price_result").innerText = JSON.stringify(data, null, 2);
    }
  </script>

</body>
</html>